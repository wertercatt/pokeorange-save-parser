import sys
import struct
import json

struct_fmt = '>6c2s3s2s2s2s2s2s2B5c2s2c'
struct_len = struct.calcsize(struct_fmt)
struct_unpack = struct.Struct(struct_fmt).unpack_from
boxPokemon = []

# extracted name tables
pokemonNames = [ # from pokeorange/data/pokemon_names.asm
"?????@@@@@",
"BULBASAUR@",
"IVYSAUR@@@",
"VENUSAUR@@",
"CHARMANDER",
"CHARMELEON",
"CHARIZARD@",
"SQUIRTLE@@",
"WARTORTLE@",
"BLASTOISE@",
"CATERPIE@@",
"METAPOD@@@",
"BUTTERFREE",
"WEEDLE@@@@",
"KAKUNA@@@@",
"BEEDRILL@@",
"PIDGEY@@@@",
"PIDGEOTTO@",
"PIDGEOT@@@",
"RATTATA@@@",
"RATICATE@@",
"SPEAROW@@@",
"FEAROW@@@@",
"EKANS@@@@@",
"ARBOK@@@@@",
"PIKACHU@@@",
"RAICHU@@@@",
"SANDSHREW@",
"SANDSLASH@",
"NIDORAN♀@@",
"NIDORINA@@",
"NIDOQUEEN@",
"NIDORAN♂@@",
"NIDORINO@@",
"NIDOKING@@",
"CLEFAIRY@@",
"CLEFABLE@@",
"VULPIX@@@@",
"NINETALES@",
"JIGGLYPUFF",
"WIGGLYTUFF",
"ZUBAT@@@@@",
"GOLBAT@@@@",
"ODDISH@@@@",
"GLOOM@@@@@",
"VILEPLUME@",
"PARAS@@@@@",
"PARASECT@@",
"VENONAT@@@",
"VENOMOTH@@",
"DIGLETT@@@",
"DUGTRIO@@@",
"MEOWTH@@@@",
"PERSIAN@@@",
"PSYDUCK@@@",
"GOLDUCK@@@",
"MANKEY@@@@",
"PRIMEAPE@@",
"GROWLITHE@",
"ARCANINE@@",
"POLIWAG@@@",
"POLIWHIRL@",
"POLIWRATH@",
"ABRA@@@@@@",
"KADABRA@@@",
"ALAKAZAM@@",
"MACHOP@@@@",
"MACHOKE@@@",
"MACHAMP@@@",
"BELLSPROUT",
"WEEPINBELL",
"VICTREEBEL",
"TENTACOOL@",
"TENTACRUEL",
"GEODUDE@@@",
"GRAVELER@@",
"GOLEM@@@@@",
"PONYTA@@@@",
"RAPIDASH@@",
"SLOWPOKE@@",
"SLOWBRO@@@",
"MAGNEMITE@",
"MAGNETON@@",
"FARFETCH'D",
"DODUO@@@@@",
"DODRIO@@@@",
"SEEL@@@@@@",
"DEWGONG@@@",
"GRIMER@@@@",
"MUK@@@@@@@",
"SHELLDER@@",
"CLOYSTER@@",
"GASTLY@@@@",
"HAUNTER@@@",
"GENGAR@@@@",
"ONIX@@@@@@",
"DROWZEE@@@",
"HYPNO@@@@@",
"KRABBY@@@@",
"KINGLER@@@",
"VOLTORB@@@",
"ELECTRODE@",
"EXEGGCUTE@",
"EXEGGUTOR@",
"CUBONE@@@@",
"MAROWAK@@@",
"HITMONLEE@",
"HITMONCHAN",
"LICKITUNG@",
"KOFFING@@@",
"WEEZING@@@",
"RHYHORN@@@",
"RHYDON@@@@",
"CHANSEY@@@",
"TANGELA@@@",
"KANGASKHAN",
"HORSEA@@@@",
"SEADRA@@@@",
"GOLDEEN@@@",
"SEAKING@@@",
"STARYU@@@@",
"STARMIE@@@",
"MR.MIME@@@",
"SCYTHER@@@",
"JYNX@@@@@@",
"ELECTABUZZ",
"MAGMAR@@@@",
"PINSIR@@@@",
"TAUROS@@@@",
"MAGIKARP@@",
"GYARADOS@@",
"LAPRAS@@@@",
"DITTO@@@@@",
"EEVEE@@@@@",
"VAPOREON@@",
"JOLTEON@@@",
"FLAREON@@@",
"PORYGON@@@",
"OMANYTE@@@",
"OMASTAR@@@",
"KABUTO@@@@",
"KABUTOPS@@",
"AERODACTYL",
"SNORLAX@@@",
"ARTICUNO@@",
"ZAPDOS@@@@",
"MOLTRES@@@",
"DRATINI@@@",
"DRAGONAIR@",
"DRAGONITE@",
"MEWTWO@@@@",
"MEW@@@@@@@",
"TROPIUS@@@",
"KECLEON@@@",
"CHATOT@@@@",
"PIKIPEK@@@",
"TRUMBEAK@@",
"TOUCANNON@",
"MUNCHLAX@@",
"ROCKRUFF@@",
"LYCANROC@@",
"WINGULL@@@",
"PELIPPER@@",
"CHINGLING@",
"CHIMECHO@@",
"SALANDIT@@",
"SALAZZLE@@",
"FINNEON@@@",
"LUMINEON@@",
"CROBAT@@@@",
"CHINCHOU@@",
"LANTURN@@@",
"PICHU@@@@@",
"CLEFFA@@@@",
"IGGLYBUFF@",
"TOGEPI@@@@",
"TOGETIC@@@",
"TOGEKISS@@",
"AZURILL@@@",
"MAREEP@@@@",
"FLAAFFY@@@",
"AMPHAROS@@",
"BELLOSSOM@",
"MARILL@@@@",
"AZUMARILL@",
"MIME JR.@@",
"POLITOED@@",
"HOPPIP@@@@",
"SKIPLOOM@@",
"JUMPLUFF@@",
"STUNFISK@@",
"SUNKERN@@@",
"SUNFLORA@@",
"LEAFEON@@@",
"GLACEON@@@",
"SYLVEON@@@",
"ESPEON@@@@",
"UMBREON@@@",
"RELICANTH@",
"SLOWKING@@",
"MIMIKYU@@@",
"SPINDA@@@@",
"SKRELP@@@@",
"DRAGALGE@@",
"TRAPINCH@@",
"VIBRAVA@@@",
"FLYGON@@@@",
"TURTONATOR",
"STEELIX@@@",
"WAILMER@@@",
"WAILORD@@@",
"QWILFISH@@",
"SCIZOR@@@@",
"SHUCKLE@@@",
"MAREANIE@@",
"TOXAPEX@@@",
"SANDYGAST@",
"PALOSSAND@",
"SLUGMA@@@@",
"MAGCARGO@@",
"CARVANHA@@",
"SHARPEDO@@",
"CORSOLA@@@",
"REMORAID@@",
"OCTILLERY@",
"MANTYKE@@@",
"MANTINE@@@",
"SKARMORY@@",
"MAGMORTAR@",
"ELECTIVIRE",
"KINGDRA@@@",
"PHANPY@@@@",
"DONPHAN@@@",
"PORYGON2@@",
"PORYGON-Z@",
"LICKILICKY",
"TYROGUE@@@",
"HITMONTOP@",
"SMOOCHUM@@",
"ELEKID@@@@",
"MAGBY@@@@@",
"HAPPINY@@@",
"BLISSEY@@@",
"CUTIEFLY@@",
"RIBOMBEE@@",
"TANGROWTH@",
"RHYPERIOR@",
"MAGNEZONE@",
"MARSHADOW@",
"LUGIA@@@@@",
"HO-OH@@@@@",
"CELEBI@@@@",
"LATIAS@@@@",
"LATIOS@@@@",
"EGG@@@@@@@",
"?????@@@@@"
]
landmarkConstants = [ # from pokeorange/constants/landmark_constants.asm
    "SPECIAL_MAP",
    "VALENCIA_ISLAND",
    "ROUTE_49",
    "TANGELO_ISLAND",
    "ROUTE_50",
    "ROUTE_51",
    "TANGELO_JUNGLE",
    "ROUTE_52",
    "MIKAN_ISLAND",
    "ROUTE_53",
    "ROUTE_54",
    "MANDARIN_NORTH",
    "SUNBURST_ISLAND",
    "ROUTE_55",
    "CRYSTAL_CAVE",
    "PINKAN_ISLAND",
    "ROUTE_56",
    "FUKUHARA_4",
    "KINNOW_ISLAND",
    "ROUTE_57",
    "UNNAMED_ISLAND_1",
    "ROUTE_58",
    "NAVEL_ISLAND",
    "MT_NAVEL",
    "GRAPEFRUIT",
    "ROUTE_59",
    "MORO_ISLAND",
    "ROUTE_60",
    "WRECKED_SHIP",
    "GOLDEN_ISLAND",
    "ROUTE_61",
    "MURCOTT_ISLAND",
    "UNNAMED_ISLAND_2",
    "ROUTE_62",
    "MANDARIN_DESERT",
    "TROVITOPOLIS",
    "TROVITA_ISLAND",
    "CLEOPATRA_ISLAND",
    "ROUTE_63",
    "ASCORBIA_ISLAND",
    "ROUTE_64",
    "ROUTE_65",
    "BUTWAL_ISLAND",
    "ROUTE_66",
    "KUMQUAT_ISLAND",
    "ROUTE_67",
    "RIND_ISLAND",
    "ROUTE_68",
    "UNNAMED_ISLAND_3",
    "ROUTE_69",
    "VICTORY_ROAD",
    "PUMMELO_ISLAND",
    "ROUTE_70",
    "TARROCO_ISLAND",
    "ROUTE_71",
    "HAMLIN_ISLAND",
    "HAMLIN_FIELDS",
    "SHAMOUTI_ISLAND",
    "FIRE_ISLAND",
    "ICE_ISLAND",
    "LIGHTNING_ISLAND",
    "VERMILION_CITY",
    "ROUTE_11",
    "ROUTE_12",
    "ROUTE_13",
    "ROUTE_14",
    "ROUTE_15",
    "FUCHSIA_CITY",
    "SAFARI_ZONE",
    "ROUTE_19",
    "ROUTE_20",
    "SEAFOAM_ISLANDS",
    "CINNABAR_ISLAND",
    "CINNABAR_VOLCANO",
    "ROUTE_21",
    "PALLET_TOWN",
    "CINNABAR_SEA",
    "SAYDA_ISLAND",
    "KANTO_SEA_1",
    "CAMOMILE_ISLAND",
    "VERMILION_SEA",
    "KANTO_SEA_2",
    "CHRYSANTHEMUM",
    "METALLICA_ISLAND",
    "KANTO_SEA_3",
    "WISTERIA_TOWN",
    "HUTBER_CITY",
    "PORTA_VISTA",
    "ACAPULCO_TOWN",
    "NEW_ISLAND",
    "RAINBOW_ISLAND",
    "FAST_SHIP"
]

def read_chunks(f, length):
    while True:
        data = f.read(length)
        if not data: break
        yield data

with open(sys.argv[1], "rb") as savFile:
    save = [struct_unpack(chunk) for chunk in read_chunks(savFile, struct_len)]
    print("Read", len(save), "Pokemon from Active Box.")
    for idx, x in enumerate(save):
        print(len(save[idx]))
        tempDict = {}
        tempDict["mon_species"] = pokemonNames[int.from_bytes(save[idx][0], byteorder="big")]
        tempDict["caughtLocation"] = landmarkConstants[int.from_bytes(save[idx][22], byteorder="big") - 1]
        print(json.dumps(tempDict, sort_keys=True, indent=4))